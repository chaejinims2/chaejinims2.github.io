<aside class="app-sidebar">
  <nav class="app-nav">
    {% assign current = page.url %}
    {% assign url_parts = page.url | split: "/" %}
    {% if url_parts[1] == "public" %}
      {% assign page_group = url_parts[2] %}
    {% else %}
      {% assign page_group = url_parts[1] %}
    {% endif %}
    {% assign section_pages = site.pages | where: "layout", "section" | where_exp: "item", "item.url contains '/public/'" | sort: "url" %}
    {% for section_page in section_pages %}
      {% assign group_base = section_page.url %}
      {% assign segs = section_page.url | split: "/" %}
      {% assign group_key = segs[2] %}
      {% assign group_pages = site.pages | where_exp: "item", "item.url contains group_base" | sort: "url" %}
      {% assign group_title = section_page.title | default: group_key | capitalize %}
      {% unless section_page.hide %}
        <div class="app-nav-group {% if page_group == group_key %}active{% endif %}">
          <a class="app-nav-item {% if current == group_base %}active{% endif %}" href="{{ group_base }}">
            {% assign nav_icon_name = section_page.icon | default: "book" %}
            {% assign nav_icon_path = "icon/" | append: nav_icon_name | append: ".html" %}
            <span class="app-nav-ico" aria-hidden="true">{% include {{ nav_icon_path }} %}</span>
            <span class="app-nav-label">{{ group_title }}</span>
          </a>
          <div class="app-nav-sub">
            {% for p in group_pages %}
              {% if p.hide != true and p.url != group_base %}
                <a class="app-nav-sub-item {% if current == p.url %}active{% endif %}" href="{{ p.url }}">{{ p.title }}</a>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      {% endunless %}
    {% endfor %}
  </nav>
</aside>
